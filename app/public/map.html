<!--

To run this demo, you need to replace 'YOUR_API_KEY' with an API key from the ArcGIS Developers dashboard.

Sign up for a free account and get an API key.

https://developers.arcgis.com/documentation/mapping-apis-and-services/get-started/

-->

<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>ArcGIS Maps SDK for JavaScript Tutorials: Find a route and directions</title>
    <style>
        html, body, #viewDiv {
            padding: 0;
            margin: 0;
            height: 100%;
            width: 100%;
        }
    </style>
    <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">
    <script src="https://js.arcgis.com/4.27/"></script>

    <script>

        require([
            "esri/config",
            "esri/Map",
            "esri/views/MapView",

            "esri/Graphic",
            "esri/rest/route",
            "esri/rest/support/RouteParameters",
            "esri/rest/support/FeatureSet"

        ], function (esriConfig, Map, MapView, Graphic, route, RouteParameters, FeatureSet) {

            esriConfig.apiKey = "AAPKddecf255c07c470d8e78fea7e56d2667eXmpBQKPWZhEYPprOkj9ewfcMFRvFEcuAAvRg_TuZaBQ-NJqptegRQZDMAWHqVUu";

            const map = new Map({
                basemap: "arcgis-navigation" //Basemap layer service
            });

            

            const view = new MapView({
                container: "viewDiv",
                map: map,
                center: [18.063240, 59.334591], //Longitude, latitude
                zoom: 10
            });
            view.on("load", addControls());
            const routeUrl = "https://route-api.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World";

            async function addGraphic() {
                var response = await fetch('https://allwinapi20230830114644.azurewebsites.net/api/Stop/route/1');
                var stops = await response.json(); //extract JSON from the http response
                for (let i = 0; i < stops.length; i++) {
                    var point = { //Create a point
                        type: "point",
                        longitude: stops[i].longitude,
                        latitude: stops[i].latitude
                    };
                    const graphic = new Graphic({
                        symbol: {
                            type: "simple-marker",
                            color: getColor(i, stops.length - 1),
                            size: "12px"
                        },
                        geometry: point
                    });
                    view.graphics.add(graphic);
                }   
                getRoute(); // Call the route service
            }

            function getColor(i, x) {
                if (i == 0) {
                    return "green";
                } else if (i == x) {
                    return "red";
                } else {
                    return "black";
                }

            }

            function getRoute() {
                const routeParams = new RouteParameters({
                    stops: new FeatureSet({
                        features: view.graphics.toArray()
                    }),

                    returnDirections: true
                });

                route.solve(routeUrl, routeParams)
                    .then(function (data) {
                        data.routeResults.forEach(function (result) {
                            result.route.symbol = {
                                type: "simple-line",
                                color: [5, 150, 255],
                                width: 3
                            };
                            view.graphics.add(result.route);
                            map.set("extent",result.route.geometry.extent);
                        });
                    })

                    .catch(function (error) {
                        console.log(error);
                    })
            }

            function addControls() {
                // Display directions
                addGraphic();
                const directions = document.createElement("div");
                //directions.innerHTML = "hello world";
                directions.classList = "esri-widget esri-widget--panel esri-directions__scroller";
                directions.style.marginTop = "0"; 
                directions.style.width = "70px";
                view.ui.empty("bottom-right");
                view.ui.add(directions, "bottom-right");

                const newButton = document.createElement('button');
                newButton.textContent = 'Starta';
                newButton.style.width = "70px";
                document.body.appendChild(newButton)

                newButton.addEventListener('click', () => {
                    alert("Start navigation");
                    
                });
                directions.appendChild(newButton);

                
            }

        });
    </script>

</head>
<body>
    <div id="viewDiv"></div>
</body>
</html>